---
name: Test
on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main
            - development
        paths:
          - "packages/**"
jobs:
    determine_changed_packages:
      uses: ./.github/workflows/changed_dir_matrix.yml
      with:
          base-dir: packages/
    test:
        name: Test
        needs: determine_changed_packages
        concurrency: test_${{ github.head_ref }}
        runs-on: ubuntu-latest
        strategy:
                matrix: ${{fromJSON(needs.determine_changed_packages.outputs.matrix)}}
        defaults:
            run:
                working-directory: ${{ matrix.dir }}
        steps:
            - name: Checkout source code
              uses: actions/checkout@v3

            - name: Build
              uses: ./.github/actions/build

            - name: Test
              run: yarn test
